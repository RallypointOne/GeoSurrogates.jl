---
title: "Utilities"
---

## normalize

Normalize data to the range `[-1, 1]`. This is required for neural network surrogates.

### Methods

```julia
normalize(x::AbstractArray)   # Normalize array
normalize(r::Raster)          # Normalize raster data and coordinates
normalize(dim::Dimension)     # Normalize dimension coordinates
normalize(nt::NamedTuple)     # Normalize all values in NamedTuple
normalize!(df::DataFrame)     # In-place normalize DataFrame columns
```

### Behavior

For numeric arrays:
```julia
normalized = 2 * (x .- min) ./ (max - min) .- 1
```

- Maps minimum value to `-1`
- Maps maximum value to `1`
- Handles `missing` values (skipped in extrema calculation)
- Returns `zero(x)` if all values are equal

### Example

```julia
using GeoSurrogates, Rasters

elev = Raster("elevation.tif")

# Normalize raster (data + coordinates)
elev_norm = normalize(elev)

# Check normalization
GeoSurrogates.is_normalized(elev_norm.data)  # true

# Normalize just an array
arr = [0.0, 50.0, 100.0]
normalize(arr)  # [-1.0, 0.0, 1.0]
```

---

## is_normalized

Check if all values in an array are within `[-1, 1]`.

```julia
is_normalized(x) -> Bool
```

### Example

```julia
using GeoSurrogates

is_normalized([0.0, 0.5, 1.0])   # true
is_normalized([-1.0, 0.0, 1.0]) # true
is_normalized([0.0, 2.0])        # false
```

---

## gaussian

Gaussian kernel function used for distance-based weighting.

```julia
gaussian(u, k) = exp(-0.5 * (k * u)^2)
```

**Arguments:**

- `u` - Distance (or any numeric value)
- `k` - Bandwidth parameter (controls decay rate)

**Returns:** Value in `(0, 1]`

- `gaussian(0, k) = 1.0` (at zero distance)
- As `u` increases, output approaches 0
- Higher `k` = faster decay (sharper boundary)

### Example

```julia
using GeoSurrogates

gaussian(0, 4)    # 1.0
gaussian(0.5, 4)  # ≈ 0.135
gaussian(1, 4)    # ≈ 0.00034

# Use with GeomWrap
gw = GeomWrap(geom; kernel=Base.Fix2(gaussian, 2))  # k=2, wider influence
gw = GeomWrap(geom; kernel=Base.Fix2(gaussian, 8))  # k=8, narrower influence
```

---

## predict

Predict values from a surrogate model. Part of the StatsAPI interface.

### Methods

```julia
predict(model::GeoSurrogate, coords::Tuple)
predict(model::GeoSurrogate, r::Raster)
```

**Return types vary by surrogate:**

| Surrogate | `predict(coords)` | `predict(raster)` |
|-----------|-------------------|-------------------|
| `LinReg` | `Number` | `Raster` |
| `RasterWrap` | `Number` | `Raster` |
| `GeomWrap` | `Float64` | `Raster` |
| `CategoricalRasterWrap` | `Dict` | `Raster{Dict}` |
| `ImplicitTerrain.MLP` | `Float32` | `Raster` |
| `ImplicitTerrain.Model` | `Float32` | `Raster` |
| `WindSIREN` | `(Float32, Float32)` | `(Raster, Raster)` |
| `CatSIREN` | `Vector{Float32}` | `Raster{Dict}` |

### Example

```julia
using GeoSurrogates

# Single point prediction
value = predict(surrogate, (-105.5, 40.2))

# Raster prediction
output = predict(surrogate, template_raster)
```

---

## fit!

Train a neural network surrogate. Part of the StatsAPI interface.

### Methods

```julia
# ImplicitTerrain
fit!(model::MLP, r::Raster; steps=1, batchsize=nothing)
fit!(model::Model, r::Raster; steps=1000, batchsize=nothing)

# WindSurrogate
fit!(model::WindSIREN, u::Raster, v::Raster; steps=1)
fit!(model::WindSIREN, uv::AbstractDimStack; steps=1)

# CategoricalSIREN
fit!(model::CatSIREN, r::Raster; steps=1)
```

**Arguments:**

- `model` - Neural network surrogate to train
- `r` / `u,v` - Training data (must be normalized for MLP/Model)
- `steps` - Number of training iterations
- `batchsize` - Mini-batch size (default: full batch)

**Returns:** The fitted model

### Example

```julia
using GeoSurrogates

model = ImplicitTerrain.Model()
fit!(model, normalize(raster); steps=2000)

# Chain calls
predicted = predict(fit!(model, data; steps=1000), test_raster)
```

---

## SIRENActivation

Sinusoidal activation function struct (internal use).

```julia
struct SIRENActivation{T} <: Function
    ω::T
end

(s::SIRENActivation)(x) = sin(s.ω * x)
```

Used internally by neural network layers. Implemented as a functor to avoid closure overhead.
